{"createdAt":"2024-10-30T06:20:01.118Z","updatedAt":"2024-12-19T05:43:14.000Z","id":"DcOO0SS1wtEi0RIY","name":"06_멤버 게시판 초대","active":true,"nodes":[{"parameters":{"endpoint":"={{ $vars.bettermode_end_point }}","requestFormat":"json","query":"=query {\n  spaceRoles(spaceId: {{ JSON.stringify($json.body[0].spaceId.id) }}) {\n    id\n    name\n    type\n    description\n  }\n}\n","variables":"=","responseFormat":"=json","headerParametersUi":{"parameter":[{"name":"={{ $vars.bettermode_client_id_key }}","value":"={{ $vars.bettermode_client_id_value }}"},{"name":"={{ $vars.bettermode_client_secret_key }}","value":"={{ $vars.bettermode_client_secret_value }}"}]}},"id":"b2a97953-520c-409a-81bd-9f61f31f09dc","name":"getSpaceRole","type":"n8n-nodes-base.graphql","typeVersion":1,"position":[660,460],"notesInFlow":true,"notes":"getSpaceRole은 space에 있는 role 데이터를 가져오기 위해 진행한다.\n\nrole의 id 값이 다 다르기 때문이다.\n\n이게 있어야 멤버를 특정 게시판에 참여시킬 수 있다."},{"parameters":{"jsCode":"// memberIds 배열 변환 로직\nconst memberIds = $('Webhook').first().json.body[0].memberId;\nconsole.log(memberIds);\n\n// 'getSpaceRole' 데이터에서 \"Member\" 역할을 찾아 roleId 추출\nconst spaceRoles = $('getSpaceRole').first().json.data.spaceRoles;\nconst memberRole = spaceRoles.find(role => role.name === 'Member');\nconst roleId = memberRole ? memberRole.id : null; // Member 역할이 없을 경우를 대비한 처리\n\n// memberIds 배열을 순회하며 roleId와 memberId로 이루어진 객체 배열 생성\nconst res = memberIds.map(id => ({\n    roleId: roleId,\n    memberId: id\n}));\n\nreturn { input: res };\n"},"id":"81b19ba5-383c-475a-b14f-5290d077e041","name":"makeArrayId","type":"n8n-nodes-base.code","typeVersion":2,"position":[880,460],"notes":"3. **멤버 ID와 역할 ID 배열 생성**: 멤버 ID와 역할 ID를 배열 형태로 변환하여 초대 준비를 완료합니다.\n"},{"parameters":{"endpoint":"={{ $vars.bettermode_end_point}}","requestFormat":"json","query":"mutation addSpaceMembers($spaceId: ID!, $input: [AddSpaceMemberInput!]!) { \n  addSpaceMembers(input: $input, spaceId: $spaceId) { \n    space { \n      id \n    } \n    member { \n      id \n      name \n    } \n  } \n}","variables":"={\n    \"spaceId\": \"{{ $node[\"Webhook\"].json[\"body\"][\"0\"][\"spaceId\"][\"id\"] }}\",\n    \"input\": {{ JSON.stringify($json.input) }}\n  }","headerParametersUi":{"parameter":[{"name":"={{ $vars.bettermode_client_id_key }}","value":"={{ $vars.bettermode_client_id_value }}"},{"name":"={{ $vars.bettermode_client_secret_key }}","value":"={{ $vars.bettermode_client_secret_value }}"}]}},"id":"16a61e8c-2c85-43e8-b5cc-1d5a91948b26","name":"inviteMember","type":"n8n-nodes-base.graphql","typeVersion":1,"position":[1140,460],"notes":"4. **멤버 초대**: `inviteMember` 노드가 멤버들을 지정된 게시판에 초대합니다.\n"},{"parameters":{"assignments":{"assignments":[{"id":"56586cdd-89e9-4128-8793-9f08d014d0ec","name":"text","value":"={{ $('makeArrayId').item.json.input.length }} 명이 게시판에 초대 됐습니다.","type":"string"}]},"options":{}},"id":"aff1dd32-223d-4543-9323-03f17a5d2be2","name":"makeSlackText","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1360,460],"notesInFlow":true,"notes":"5. **슬랙 메시지 생성**: 초대된 멤버 수를 포함한 슬랙 메시지를 생성합니다.\n"},{"parameters":{"workflowId":{"__rl":true,"value":"XVWUaUPaaiGofxQ6","mode":"list","cachedResultName":"GPTers — \bslackNoti"},"options":{}},"id":"3aa82127-6ecc-4ec0-8fca-6e853c3b38d8","name":"Execute Workflow","type":"n8n-nodes-base.executeWorkflow","typeVersion":1.1,"position":[1580,460],"notesInFlow":true,"notes":"6. **슬랙 알림 전송**: 슬랙 알림 워크플로우를 실행하여 관리자에게 알림을 보냅니다.\n"},{"parameters":{"content":"# 멤버 게시판 초대 워크플로우\n\n이 워크플로우는 지정된 멤버들을 특정 게시판에 초대하고, \n초대된 멤버 수를 슬랙으로 알림하는 프로세스를 수행합니다.\n\n## 구성 요소\n\n### 1. Webhook\n- **설명**: 외부 요청을 받아 멤버 초대 프로세스를 시작하는 웹훅 엔드포인트입니다.\n- **기능**: 게시판 초대 요청을 수신하여 워크플로우를 시작합니다.\n\n### 2. getSpaceRole\n- **설명**: Bettermode API를 사용하여 특정 게시판(space)의 역할 정보를 조회합니다.\n- **기능**: 멤버를 게시판에 초대할 때 필요한 `roleId`를 가져옵니다.\n\n### 3. makeArrayId\n- **설명**: 역할 ID와 멤버 ID를 배열로 묶어 API 요청에 사용할 준비를 합니다.\n- **기능**: `roleId`와 각 멤버의 `memberId`를 배열로 변환하여 이후 노드에서 활용할 수 있게 합니다.\n\n### 4. inviteMember\n- **설명**: 생성된 배열 데이터를 이용해 멤버들을 특정 게시판에 일괄 초대합니다.\n- **기능**: Bettermode API를 사용해 멤버들을 게시판에 추가합니다.\n\n### 5. makeSlackText\n- **설명**: 슬랙으로 전송할 메시지 텍스트를 생성합니다.\n- **기능**: 초대된 멤버 수를 확인하여 `\"X명이 게시판에 초대됐습니다.\"` 형식의 메시지를 만듭니다.\n\n### 6. Execute Workflow\n- **설명**: 생성된 메시지를 슬랙으로 전송하기 위해 다른 워크플로우를 실행합니다.\n- **기능**: 슬랙 알림을 전송하는 워크플로우를 호출하여 알림을 완료합니다.\n\n## 동작 방식\n\n1. **Webhook 요청 수신**: 외부 요청을 통해 멤버 초대 작업을 시작합니다.\n2. **역할 정보 조회**: 게시판에 초대 시 필요한 역할(`roleId`)을 조회합니다.\n3. **멤버 ID와 역할 ID 배열 생성**: 멤버 ID와 역할 ID를 배열 형태로 변환하여 초대 준비를 완료합니다.\n4. **멤버 초대**: `inviteMember` 노드가 멤버들을 지정된 게시판에 초대합니다.\n5. **슬랙 메시지 생성**: 초대된 멤버 수를 포함한 슬랙 메시지를 생성합니다.\n6. **슬랙 알림 전송**: 슬랙 알림 워크플로우를 실행하여 관리자에게 알림을 보냅니다.\n\n이 워크플로우는 멤버 초대 작업을 자동화하고, 팀이 초대 상황을 실시간으로 확인할 수 있도록 슬랙으로 알림을 보냅니다.\n","height":1004,"width":674},"id":"b67c9483-1222-4398-95dd-61b8b321c4bb","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-120,-80]},{"parameters":{"httpMethod":"POST","path":"invite_board","options":{}},"id":"9f33c525-8d4d-4e32-a979-6c61f19617b0","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[460,460],"webhookId":"fca6661b-05f0-405b-948f-ed4f17d0676a","notesInFlow":true,"notes":"1. **Webhook 요청 수신**: 외부 요청을 통해 멤버 초대 작업을 시작합니다.\n"}],"connections":{"getSpaceRole":{"main":[[{"node":"makeArrayId","type":"main","index":0}]]},"makeArrayId":{"main":[[{"node":"inviteMember","type":"main","index":0}]]},"inviteMember":{"main":[[{"node":"makeSlackText","type":"main","index":0}]]},"makeSlackText":{"main":[[{"node":"Execute Workflow","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"getSpaceRole","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"2FkHbmnpOA9Y42fo"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"geniefy.app.n8n.cloud","user-agent":"Mozilla/5.0 (compatible; AirtableScripting; +https://airtable.com/developers/scripting;)","content-length":"502","accept":"*/*","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1; subreqs=1","cf-connecting-ip":"3.238.126.41","cf-ew-via":"15","cf-ipcountry":"US","cf-ray":"8f3b6e9014d26fe0-IAD","cf-visitor":"{\"scheme\":\"https\"}","cf-worker":"n8n.cloud","content-type":"application/json","x-airtable-source":"appq8xK4PLp7D7aCg/wfloHsG7UF0B0Q2gB","x-forwarded-for":"3.238.126.41, 172.70.175.34","x-forwarded-host":"geniefy.app.n8n.cloud","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"traefik-prod-users-gwc-5-6fbf5bdbfc-cjt7j","x-is-trusted":"yes","x-real-ip":"3.238.126.41"},"params":{},"query":{},"body":[{"spaceId":{"id":"rLQ6SxJ3NmPs","type":"Group","slug":"-vszx4jfv","name":"테스트 공간🥎"},"memberId":["vqryGgbb4C","LttgcnvNfH","pxKBUPj6EE","yAmnPRuHpt","Wq23Fqroas","szuLQLRwKr","yjQGVOIgPO","xZLW61xtT2","xcyt6T8TDh","jqseIIG5ia","YeDmkT6IfT","20aT8j7MHK","MPZs0d0KyK","hI2kvKQpKK","gzUjgVAOpT","UFfOk2W6NN","ohQCdqDwZY","UUIeMyXzEE","GjOAr7cObh","0K24Q2QjTs","cVDTbZIh9d","7gIrrbnMnU","uLtXFZnDVY","ajmIXQhUy3","bKhQGO702V","1WxEkQrgLn","59Q8okkLVo","RtzpXX3hHa","mwvE53sQFB","Xp5KtqogPf"]}],"webhookUrl":"https://geniefy.app.n8n.cloud/webhook/invite_board","executionMode":"production"}}]},"versionId":"3ad44daa-641d-4bc3-b65e-cb4f9f4c5e73","triggerCount":1,"tags":[{"createdAt":"2024-12-19T05:43:13.292Z","updatedAt":"2024-12-19T05:43:13.292Z","id":"QyOnBrPoEGiu3Pw7","name":"게시판"}]}