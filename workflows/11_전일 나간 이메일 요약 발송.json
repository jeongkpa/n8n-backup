{"createdAt":"2024-11-20T05:46:38.268Z","updatedAt":"2024-12-20T03:05:23.000Z","id":"xGdv4X5B1xMT6qVb","name":"11_ì „ì¼ ë‚˜ê°„ ì´ë©”ì¼ ìš”ì•½ ë°œì†¡","active":true,"nodes":[{"parameters":{"mode":"runOnceForEachItem","jsCode":"const timestamp = new Date($json[\"timestamp\"]);\n\n// Set today 9 AM\nconst today9am = new Date(timestamp);\ntoday9am.setUTCHours(0, 0, 0, 0);\ntoday9am.setDate(today9am.getDate()); // Move to the previous day for \"today\"\n\n// Set yesterday 9 AM\nconst yesterday9am = new Date(today9am);\nyesterday9am.setDate(yesterday9am.getDate() - 1); // Move to the day before \"yesterday\"\n\n// Format to ISO 8601 without milliseconds\nconst formattedToday = today9am.toISOString().split('.')[0] + 'Z';\nconst formattedYesterday = yesterday9am.toISOString().split('.')[0] + 'Z';\n\nreturn {\n  today: formattedToday,\n  yesterday: formattedYesterday\n};\n"},"id":"916ba0ca-4b07-46aa-b0d4-f513059b14f2","name":"ì–´ì œì™€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°","type":"n8n-nodes-base.code","typeVersion":2,"position":[2840,480],"notes":"ì–´ì œì™€ ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ISO í˜•ì‹ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤."},{"parameters":{"url":"={{ $vars.gpters_internal_api_endpoint }}/emails/logs/group","sendQuery":true,"queryParameters":{"parameters":[{"name":"startDate","value":"={{ $json.yesterday }}"},{"name":"endDate","value":"={{ $json.today }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"={{ $vars.gpters_internal_api_token_key }}","value":"={{ $vars.gpters_internal_api_token }}"}]},"options":{}},"id":"0fa1bee3-2865-45d5-8101-7854528ea833","name":"ì „ì¼ ì´ë©”ì¼ ë¡œê·¸ ì¡°íšŒ","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3080,480],"notes":"ë‚´ë¶€ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì „ì¼ ë°œì†¡ëœ ì´ë©”ì¼ ë¡œê·¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤."},{"parameters":{"jsCode":"// ì´ë©”ì¼ ì•„ì´í…œ ë°°ì—´ ì¶”ì¶œ\nconst emailItems = items[0].json.items;\n\n// ì´ë©”ì¼ ìš”ì•½ ë°°ì—´ ì´ˆê¸°í™”\nlet emailSummaries = [];\n\n// ì´ë©”ì¼ ì•„ì´í…œì´ ìˆëŠ”ì§€ í™•ì¸\nif (!emailItems || !Array.isArray(emailItems)) {\n  throw new Error('ìœ íš¨í•œ ì´ë©”ì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');\n}\n\n// ê° ì´ë©”ì¼ ì•„ì´í…œ ì²˜ë¦¬\nemailItems.forEach(emailItem => {\n  const emailId = emailItem.emailId;\n\n  const transactionId = emailItem.transactionId;\n  const count = emailItem.count;\n  const subject = emailItem.preview.subject;\n  let htmlContent = emailItem.preview.htmlContent;\n\n  // ê¸°ì¡´ì— í…ìŠ¤íŠ¸ ë³€í™˜, ë§í¬ ì¶”ì¶œ ë“± ìš”ì•½ì„ í–ˆë˜ ë¶€ë¶„ì„ ëª¨ë‘ ìƒëµ\n  // ì›ë¬¸ HTMLì„ ê·¸ëŒ€ë¡œ ë‹´ì„ ê²½ìš° ê·¸ëƒ¥ htmlContentë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.\n\n  const summary = {\n    emailId,\n    transactionId,\n    count,\n    subject,\n    // ì—¬ê¸°ì„œ htmlContentë¥¼ ê·¸ëŒ€ë¡œ contentë¡œ ì‚¬ìš©\n    content: htmlContent\n  };\n  emailSummaries.push(summary);\n});\n\n// ì´ ì´ë©”ì¼ ìˆ˜ì™€ ì´ ë°œì†¡ ìˆ˜ ê³„ì‚°\nconst totalEmails = emailSummaries.length;\nconst totalSent = emailSummaries.reduce((sum, email) => sum + email.count, 0);\n\n// ì–´ì œ ë‚ ì§œ í¬ë§·íŒ…\nconst yesterday = new Date();\nyesterday.setDate(yesterday.getDate() - 1);\nconst formattedDate = yesterday.toISOString().split('T')[0];\n\n// ì´ë©”ì¼ ë‚´ìš©ì„ ìµœì¢…ì ìœ¼ë¡œ ë¬¶ëŠ” ë¶€ë¶„\n// ì´ì œ ê° ì´ë©”ì¼ í•­ëª©ì— ëŒ€í•´ summary.contentì— ë‹´ê¸´ HTML ê·¸ëŒ€ë¡œë¥¼ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nlet emailContent = `\n<!DOCTYPE html>\n<html lang=\"ko\">\n<head>\n<meta charset=\"UTF-8\">\n<title>ì „ì¼ ë°œì†¡ëœ ì´ë©”ì¼ ì›ë¬¸ ëª©ë¡</title>\n<style>\n  body {\n    font-family: Arial, sans-serif;\n    line-height: 1.6;\n    max-width: 800px;\n    margin: 0 auto;\n    padding: 20px;\n  }\n  .email-entry {\n    margin-bottom: 30px;\n    padding: 20px;\n    background-color: #f9f9f9;\n    border-left: 4px solid #007bff;\n    border-radius: 4px;\n  }\n  .email-subject {\n    font-size: 1.2em;\n    font-weight: bold;\n    color: #007bff;\n    margin-bottom: 20px;\n  }\n  .email-meta {\n    font-size: 0.9em;\n    color: #666;\n    margin-bottom: 20px;\n    white-space: pre-line;\n  }\n</style>\n</head>\n<body>\n<h2>ì „ì¼ ë°œì†¡ëœ ì´ë©”ì¼ ì›ë¬¸ ëª©ë¡ (${formattedDate})</h2>\n`;\n\nif (emailSummaries.length > 0) {\n  emailSummaries.forEach(summary => {\n    // summary.contentì—ëŠ” ì›ë¬¸ HTMLì´ ë“¤ì–´ìˆìŒ\n    emailContent += `\n<div class=\"email-entry\">\n  <div class=\"email-subject\">${summary.subject}</div>\n  <div class=\"email-meta\">\n    ğŸ“‹ ì´ë©”ì¼ ID: ${summary.emailId}<br>\n    ğŸ” íŠ¸ëœì­ì…˜ ID: ${summary.transactionId}<br>\n    ğŸ“¨ ë°œì†¡ ìˆ˜: ${summary.count}ê±´\n  </div>\n  <div class=\"email-content\">\n    ${summary.content}\n  </div>\n</div>`;\n  });\n\n  emailContent += `\n<div class=\"summary\" style=\"margin-top:30px;padding:20px;background-color:#e9ecef;border-radius:4px;\">\n  <h3>ë°œì†¡ ìš”ì•½</h3>\n  <p>ğŸ“Š ì´ ì´ë©”ì¼ ì¢…ë¥˜: ${totalEmails}ê°œ<br>\n  ğŸ“¬ ì´ ë°œì†¡ ìˆ˜: ${totalSent}ê±´</p>\n</div>`;\n} else {\n  emailContent += '<p>ì „ì¼ ë°œì†¡ëœ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';\n}\n\nemailContent += `\n</body>\n</html>\n`;\n\nreturn [\n  {\n    json: {\n      emailContent: emailContent\n    }\n  }\n];\n"},"id":"62934ff2-1166-4a92-ac98-9667e42a49db","name":"ì´ë©”ì¼ ìš”ì•½ ìƒì„±","type":"n8n-nodes-base.code","typeVersion":2,"position":[3740,480],"notes":"ì´ë©”ì¼ ë¡œê·¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ì—¬ ìš”ì•½ ë©”ì¼ ë‚´ìš©ì„ ìƒì„±í•©ë‹ˆë‹¤."},{"parameters":{"method":"POST","url":"={{ $vars.gpters_internal_api_endpoint }}/emails","sendHeaders":true,"headerParameters":{"parameters":[{"name":"={{ $vars.gpters_internal_api_token_key }}","value":"={{ $vars.gpters_internal_api_token }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"content","value":"={{ $json.emailContent }}"},{"name":"preview","value":"={{ $('ì–´ì œì™€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°').item.json.yesterday.slice(0,10) }}ì— ë³´ë‚´ì§„ ì´ë©”ì¼ ìš”ì•½ì…ë‹ˆë‹¤."},{"name":"bcc","value":"={{ [JSON.stringify(\"all@gpters.org\") ]}}"},{"name":"title","value":"={{ $('ì–´ì œì™€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°').item.json.yesterday.slice(0,10) }}ì— ë³´ë‚´ì§„ ì´ë©”ì¼ ìš”ì•½ì…ë‹ˆë‹¤."}]},"options":{}},"id":"fbb2101c-dce3-4005-98d4-48230f6ee35d","name":"ìš”ì•½ ì´ë©”ì¼ ë°œì†¡","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3960,480],"notes":"ìƒì„±ëœ ì´ë©”ì¼ ìš”ì•½ ë‚´ìš©ì„ ë‚´ë¶€ APIë¥¼ í†µí•´ íŒ€ì—ê²Œ ë°œì†¡í•©ë‹ˆë‹¤."},{"parameters":{"assignments":{"assignments":[{"id":"7ea6ec51-126a-4771-8603-55627af4fbf0","name":"text","value":"={{ $('ì–´ì œì™€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°').item.json.yesterday.slice(0,10) }}ì— ë³´ë‚¸ ì´ë©”ì¼ì— ëŒ€í•œ ìš”ì•½ ë©”ì¼ì„ ë°œì†¡í•˜ì˜€ìŠµë‹ˆë‹¤.","type":"string"}]},"options":{}},"id":"3a43f84e-ac2b-46a8-9371-7a2c5681dde0","name":"ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4400,480],"notes":"ìš”ì•½ ì´ë©”ì¼ ë°œì†¡ í›„ ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤."},{"parameters":{"workflowId":{"__rl":true,"value":"XVWUaUPaaiGofxQ6","mode":"list","cachedResultName":"GPTers â€” slackNoti_airtable"},"options":{}},"id":"f71bfe55-6a99-41e7-8990-54662b131b38","name":"ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡","type":"n8n-nodes-base.executeWorkflow","typeVersion":1.1,"position":[4620,480],"notes":"ìš”ì•½ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œë¥¼ ìŠ¬ë™ì— ì•Œë¦½ë‹ˆë‹¤."},{"parameters":{"rule":{"interval":[{"triggerAtHour":9}]}},"id":"69e4d2c2-6147-458e-abdf-ce8a81a49e4a","name":"ë§¤ì¼ ì˜¤ì „ 9ì‹œ íŠ¸ë¦¬ê±°","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[2620,480],"notes":"ë§¤ì¼ ì˜¤ì „ 8ì‹œì— ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤."},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"665b4a80-8a2c-48f8-9acd-57ad3e2f0c33","leftValue":"={{ $json.rejected }}","rightValue":"","operator":{"type":"array","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"fba09fb0-8581-4ab3-8ac3-ad11b344b814","name":"If","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[4180,480]},{"parameters":{"workflowId":{"__rl":true,"value":"XVWUaUPaaiGofxQ6","mode":"list","cachedResultName":"GPTers â€” slackNoti_airtable"},"options":{}},"id":"99bd5eb7-007c-4acf-9a8d-09aca27be3f7","name":"ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡1","type":"n8n-nodes-base.executeWorkflow","typeVersion":1.1,"position":[4620,680],"notes":"ìš”ì•½ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œë¥¼ ìŠ¬ë™ì— ì•Œë¦½ë‹ˆë‹¤."},{"parameters":{"assignments":{"assignments":[{"id":"7ea6ec51-126a-4771-8603-55627af4fbf0","name":"text","value":"=ì´ë©”ì¼ì— ëŒ€í•œ ìš”ì•½ ë©”ì¼ì„ ë°œì†¡ì„ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.","type":"string"}]},"options":{}},"id":"abfec763-f22a-4771-a0b3-4cbbe445ad2e","name":"ì—ëŸ¬ ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4400,680],"notes":"ìš”ì•½ ì´ë©”ì¼ ë°œì†¡ í›„ ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤."},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n## ì´ë©”ì¼ì´ ë°œì†¡ë˜ì§€ ì•Šì•˜ì„ ë•Œ ì˜ˆì™¸ì²˜ë¦¬","height":223.47674418604663,"width":473.54651162790697,"color":7},"id":"79526a69-6720-4949-8205-63593b3f3d9d","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4280,660]},{"parameters":{"content":"## ë‚ ì§œ ë°ì´í„° ì „ì²˜ë¦¬","height":222.37406055019858,"width":392.6523060833808},"id":"32bcbfeb-e1bb-4b81-b402-b64409de3657","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2580,400]},{"parameters":{"content":"## ì´ë©”ì¼ ë¡œê·¸ ì¡°íšŒ í›„ ì´ë©”ì¼ ìš”ì•½ì„ ìƒì„±í•˜ì—¬ all@gpters.orgë¡œ ë°œì†¡","height":283.10669845433944,"width":609.3200953630171},"id":"82e58316-43ce-4426-8c45-03d9874d22e0","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3040,380]},{"parameters":{"content":"## ì´ë©”ì¼ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ í›„ ìŠ¬ë™ ì•Œë¦¼","height":325.7836872518435,"width":514.1175818916616},"id":"6badf5d4-22e9-44b6-a0e5-9e585d9a00ba","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3920,320]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6f7b74f7-8a49-4f63-80d7-7dc19dbe4ae0","leftValue":"={{ $json.items }}","rightValue":"","operator":{"type":"array","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"788f64e4-079e-434c-97c2-75727ac422db","name":"If1","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3300,480]},{"parameters":{},"id":"4eb1a9f2-87dc-42c6-a480-f8b580b51529","name":"ì „ì¼ ì´ë©”ì¼ ì—†ìœ¼ë©´ ë‘ë‚«ëµ","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3740,660]}],"connections":{"ì–´ì œì™€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°":{"main":[[{"node":"ì „ì¼ ì´ë©”ì¼ ë¡œê·¸ ì¡°íšŒ","type":"main","index":0}]]},"ì „ì¼ ì´ë©”ì¼ ë¡œê·¸ ì¡°íšŒ":{"main":[[{"node":"If1","type":"main","index":0}]]},"ì´ë©”ì¼ ìš”ì•½ ìƒì„±":{"main":[[{"node":"ìš”ì•½ ì´ë©”ì¼ ë°œì†¡","type":"main","index":0}]]},"ìš”ì•½ ì´ë©”ì¼ ë°œì†¡":{"main":[[{"node":"If","type":"main","index":0}]]},"ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •":{"main":[[{"node":"ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡","type":"main","index":0}]]},"ë§¤ì¼ ì˜¤ì „ 9ì‹œ íŠ¸ë¦¬ê±°":{"main":[[{"node":"ì–´ì œì™€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°","type":"main","index":0}]]},"If":{"main":[[{"node":"ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •","type":"main","index":0}],[{"node":"ì—ëŸ¬ ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •","type":"main","index":0}]]},"ì—ëŸ¬ ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •":{"main":[[{"node":"ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡1","type":"main","index":0}]]},"If1":{"main":[[{"node":"ì´ë©”ì¼ ìš”ì•½ ìƒì„±","type":"main","index":0}],[{"node":"ì „ì¼ ì´ë©”ì¼ ì—†ìœ¼ë©´ ë‘ë‚«ëµ","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":false,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"2FkHbmnpOA9Y42fo"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:ë§¤ì¼ ì˜¤ì „ 8ì‹œ íŠ¸ë¦¬ê±°":{"recurrenceRules":[]},"node:ë§¤ì¼ ì˜¤ì „ 9ì‹œ íŠ¸ë¦¬ê±°":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"ë§¤ì¼ ì˜¤ì „ 9ì‹œ íŠ¸ë¦¬ê±°":[{"json":{"timestamp":"2024-12-20T09:00:22.006+09:00","Readable date":"December 20th 2024, 9:00:22 am","Readable time":"9:00:22 am","Day of week":"Friday","Year":"2024","Month":"December","Day of month":"20","Hour":"09","Minute":"00","Second":"22","Timezone":"Asia/Seoul (UTC+09:00)"}}]},"versionId":"9c2227c1-e72b-453d-afec-603f00c844b1","triggerCount":1,"tags":[{"createdAt":"2024-10-30T08:32:06.157Z","updatedAt":"2024-10-30T08:32:06.157Z","id":"6XNkyT4y92x85aDE","name":"ì´ë©”ì¼"}]}